// Copyright 2021 CloudJ Company Limited. All rights reserved.

package common

// 以下值会在编译时动态注入(见 Makefile)。
var (
	VERSION = "v0.0.0"
	BUILD   = "000000"
)

const (
	TaskTypePlan    = "plan"    // 计划执行，不会修改资源或做服务配置
	TaskTypeApply   = "apply"   // 执行 terraform apply 和 playbook
	TaskTypeDestroy = "destroy" // 销毁，删除所有资源
	TaskTypeScan    = "scan"    // 策略扫描，只执行策略扫描，不修改资源或配置
	TaskTypeParse   = "parse"   // 策略扫描，只执行策略扫描，不修改资源或配置

	// TODO 与 taskTypexxx 重复，需要替换
	TaskJobPlan    = "plan"
	TaskJobApply   = "apply"
	TaskJobDestroy = "destroy"
	TaskJobScan    = "scan"
	TaskJobParse   = "parse"

	TaskPending   = "pending"
	TaskRunning   = "running"
	TaskApproving = "approving"
	TaskRejected  = "rejected"
	TaskFailed    = "failed"
	TaskComplete  = "complete"

	TaskStepCheckout    = "checkout"
	TaskStepTfInit      = "terraformInit"
	TaskStepTfPlan      = "terraformPlan"
	TaskStepTfApply     = "terraformApply"
	TaskStepTfDestroy   = "terraformDestroy"
	TaskStepAnsiblePlay = "ansiblePlay" // play playbook
	TaskStepCommand     = "command"     // run command
	TaskStepCollect     = "collect"     // 任务结束后的信息采集
	TaskStepScanInit    = "scaninit"
	TaskStepTfParse     = "tfparse" // 云模板解析
	TaskStepTfScan      = "tfscan"  // 云模板策略扫描

	PipelineFileName = ".cloudiac-pipeline.yml"

	// 结束采集步骤的索引
	CollectTaskStepIndex = -1

	TaskStepPending   = "pending"
	TaskStepApproving = "approving"
	TaskStepRejected  = "rejected"
	TaskStepRunning   = "running"
	TaskStepFailed    = "failed"
	TaskStepComplete  = "complete"
	TaskStepTimeout   = "timeout"

	TaskStepPolicyViolationExitCode = 3 // 合规检查不通过时的退出码

	TaskTypePlanName    = "plan"
	TaskTypeApplyName   = "apply"
	TaskTypeDestroyName = "destroy"
	TaskTypeScanName    = "scan"

	TaskStepTimeoutDuration = 600

	VcsGitlab = "gitlab"
	VcsGitea  = "gitea"
	VcsGitee  = "gitee"
	VcsGithub = "github"

	PolicyStatusPending    = "pending"
	PolicyStatusPassed     = "passed"
	PolicyStatusFailed     = "failed"
	PolicyStatusViolated   = "violated"
	PolicyStatusSuppressed = "suppressed"

	PolicySeverityHigh   = "high"
	PolicySeverityMedium = "medium"
	PolicySeverityLow    = "low"

	PolicySuppressTypeSource = "source"
	PolicySuppressTypePolicy = "policy"
)

var (
	TerraformVersions = []string{
		"0.11.15",
		"0.12.31",
		"0.13.7",
		"0.14.11",
		"0.15.5",
		"1.0.6",
	}
)

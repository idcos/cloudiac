# 云模板

## 什么是云模板

云模板是CloudIaC中定义的一种可以部署的环境类型；

云模板由名称、描述、一组描述部署的有效配置文件以及一组变量组成；

通过云模板中的『部署新环境』可以立即开始创建新环境。

## 创建云模板

云模板需要关联到您的git仓库，该仓库包含您对资源的描述配置文件，以及在资源创建成功后需要部署的应用描述配置文件；

在创建云模板之前您需要添加VCS来源，在『组织设置』-『VCS』中，点击『添加VCS』来添加新的git仓库来源；

要创建新模板，请点击『组织设置』-『云模板』中的『新建云模板』来进行添加；

输入模板名称、描述、选择相应的VCS和代码仓库、分支/标签信息，您还可以指定部署时的工作目录，前提是您的代码仓库中存在该目录；

接下来您可以编辑云模板中的变量，编辑时您可以看到从组织中继承的变量，您可以对继承的变量进行重新赋值或创建新的变量；

您可以在变量配置中选择是否需要加载指定的terraform的tfvars文件；

如果您的资源描述配置文件包含对应用部署的配置，则您可以选择需要在部署中使用的playbook文件，这样在部署过程中terraform创建资源完成后会自动调用ansible playbook来进行应用的自动部署；

最后选择将云模板关联到哪些项目，关联的项目下就可以使用该云模板进行环境的部署了。

## 管理云模板

云模板在组织范围内添加、编辑或删除；

云模板由组织管理员创建、编辑和删除，普通用户只能基于已创建好的云模板进行部署或plan计划，但可以在发起部署操作时对变量进行修改；

在云模板创建后，您可以在编辑操作中修改云模板的配置，例如引用不同VCS仓库的代码仓库、分支或标签；

对云模板的修改只会影响基于该云模板的新部署，要将更新应用到活跃状态的环境，必须对该环境执行『重新部署』；

如果您需要删除云模板，在检查该云模板没有活跃状态的环境存在的前提下，可以删除该云模板。

## 自动重试（待开放）

在执行环境部署操作时，您可能希望CloudIaC在出现错误时自动重试；

针对每个云模板您可以启用自动重试，并可以配置自动重试策略：

- 在部署、销毁或这两种情况下进行重试，并设置重试次数
- 您还可以定义一个正则表达式，这样CloudIaC只会重试某些错误，如果不提供正则表达式，将重试所有错误
